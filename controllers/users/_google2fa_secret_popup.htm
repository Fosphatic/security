<?php

use PragmaRX\Google2FA\Google2FA;

$google2fa = new Google2FA();

$secretKey = $user->google2fa_secret ?? $google2fa->generateSecretKey();

$qrCodeUrl = $google2fa->getQRCodeGoogleUrl(
    e(Backend\Models\BrandSetting::get('app_tagline')),
    $user->email,
    $secretKey
);
?>
<div class="modal-header">
    <button type="button" class="close" data-dismiss="popup" aria-hidden="true">&times;</button>
    <h4 class="modal-title">Setup Google Two Factor Authentication</h4>

</div>
<div class="modal-body">
    <p>Download the Google Authenticator app and scan the QR-code. It's recommended to keep a backup of this QR-code. Do not share this QR-code with anyone.</p>
    <hr>
    <div class="row">
        <div class="col-md-7">
            <img src="/plugins/adrenth/security/assets/images/google2-factor.png" width="100%">
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <img src="<?= $qrCodeUrl ?>" width="100%" style="border: 2px dashed #BDC3C7;">
            </div>
        </div>
    </div>
    <input type="hidden" name="User[google2fa_secret]" value="<?= $secretKey ?>">

    <div class="form-buttons">
        <div class="loading-indicator-container">
            <button
                type="submit"
                data-request="onSave"
                data-request-data="redirect:0"
                data-load-indicator="<?= e(trans('backend::lang.form.saving')) ?>"
                class="btn btn-primary pull-right">
                Enable for this user
            </button>
            <span class="btn-text pull-right">
                <a href="<?= Backend::url('adrenth/redirect/redirects') ?>"><?= e(trans('backend::lang.form.cancel')) ?></a>
            </span>
        </div>
    </div>
</div>
